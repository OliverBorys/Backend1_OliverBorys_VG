<h2 class="orders-title">Orders</h2>

<div class="filters">
  <div class="filters-row">
    <div class="filter">
      <label>From</label>
      <input type="date" [(ngModel)]="filter.from" />
    </div>
    <div class="filter">
      <label>To</label>
      <input type="date" [(ngModel)]="filter.to" />
    </div>
    <div class="filter grow">
      <label>Customer (name / email / username)</label>
      <input type="text" placeholder="Search…" [(ngModel)]="filter.customer" />
    </div>
    <div class="filter-actions">
      <button class="btn" (click)="load()">Apply</button>
      <button class="btn btn-ghost" (click)="resetFilters()">Reset</button>
    </div>
  </div>
</div>

@if (loading) {
  <div class="loading">Loading…</div>
}
@if (!loading && orders.length === 0) {
  <div class="no-orders">No orders found.</div>
}

@for (order of orders; track order) {
  <div class="order-card">
    <div class="order-header">
      <div>
        <h3>Order #{{ order.id }}</h3>
        <p class="muted">
          <strong>Date:</strong> {{ order.createdAt | date: 'medium' }}
          &nbsp;•&nbsp; <strong>Status:</strong> {{ order.status }}
          &nbsp;•&nbsp; <strong>Paid with:</strong> {{ order.paymentMethod || '—' }}
        </p>
      </div>
      <button class="delete-btn" (click)="deleteOrder(order.id)">Delete order</button>
    </div>
    <div class="order-columns">
      <div class="order-customer">
        <p><strong>Customer</strong></p>
        <ul>
          <li>
            {{ order.customer.firstName }} {{ order.customer.lastName }}
            @if (order.customer.username) {
              <span class="muted">(@{{ order.customer.username }})</span>
            }
          </li>
          <li>{{ order.customer.email }}</li>
          <li>{{ order.customer.mobilePhone }}</li>
          <li>
            {{ order.customer.address }},
            {{ order.customer.city }},
            {{ order.customer.postalCode }}
          </li>
        </ul>
      </div>
      <div class="order-items">
        <p><strong>Items</strong></p>
        <ul class="items-list">
          @for (it of order.items; track it) {
            <li class="item-row">
              @if (it.image) {
                <img [src]="it.image" alt="" class="thumb" />
              }
              <div class="item-text">
                <div class="name">{{ it.productName }}</div>
                <div class="meta">x{{ it.quantity }} — ${{ (it.unitPrice * it.quantity) | number:'1.2-2' }}</div>
              </div>
            </li>
          }
        </ul>
        <div class="total">
          <strong>Total:</strong>
          ${{ getOrderTotal(order) }}
        </div>
      </div>
    </div>
  </div>
}
